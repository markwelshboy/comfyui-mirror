#!/usr/bin/env bash
set -euo pipefail

REPO="/workspace/$(basename `git rev-parse --show-toplevel`)"

source_if_exists() {
  local f="$1"
  [[ -f "$f" ]] || return 0
  echo "[source-if-exists] Sourcing $f ..."
  # shellcheck disable=SC1090
  source "$f"
}

# Provider/session env + project env + helpers
source_if_exists "/root/.secrets/env.current"
source_if_exists "${REPO}/.env"
source_if_exists "${REPO}/helpers.sh"

# Optional: auto summaries/details if functions exist
type -t show_env            >/dev/null 2>&1 && show_env             || true

echo "[mirror] environment ready."