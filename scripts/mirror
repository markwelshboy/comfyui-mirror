#!/usr/bin/env bash
set -euo pipefail

REPO="/workspace/comfyui-mirror"

source_if_exists() {
  local f="$1"
  [[ -f "$f" ]] || return 0
  # shellcheck disable=SC1090
  source "$f"
}

# Provider/session env + project env + helpers
source_if_exists "/root/.secrets/env.current"
source_if_exists "${REPO}/.env"
source_if_exists "${REPO}/helpers.sh"

# Optional: auto summaries/details if functions exist
type -t auto_channel_detect >/dev/null 2>&1 && auto_channel_detect  || true
type -t show_env            >/dev/null 2>&1 && show_env             || true

echo "[mirror] environment ready."